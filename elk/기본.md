## [구성 환경] 

statefulset으로 아래 컴포넌트 구성됨

```
elasticsearch-coordinating   0/6     148d
elasticsearch-data           0/42    148d
elasticsearch-ingest         0/6     148d
elasticsearch-master         0/2     148d
```

kibana는 deployment

기본적인 순서는

```
elasticserach-master (user password change) -> elasticserach-data -> elasticserach-coordinating, elasticsearch-ingest
```

### [잔여 리소스 삭제]

pod

```
kubectl scale statefulset elasticsearch-master --replicas=0 -n default
kubectl scale statefulset elasticsearch-data --replicas=0 -n default
kubectl scale statefulset elasticsearch-ingest --replicas=0 -n default
kubectl scale statefulset elasticsearch-coordinating --replicas=0 -n default
kubectl scale deploy kibana --replicas=0 -n default
```

pod force delete

```
kubectl get pods -n default | grep Terminating | awk '{print $1}' | xargs -I {} kubectl delete pod {} -n default --grace-period=0 --force
```

pvc

```
kubectl delete pvc --all -n default

[specific pvc delete]
kubectl delete pvc kibana -n default
```

### [ELK 리소스 복구]

만약 kibana console에서 elastic 비번 변경시

```
kubectl get secret 의 elasticsearch의 비번과 충돌해 elk가 뻗어버린다.
```

비번 변경 (예를들어서 test로)
```
kubectl patch secret elasticsearch -n default -p='{"data":{"elasticsearch-password":"test"}}'
```

ElasticSearch 기동 (순서 주의)
```
kubectl scale statefulset elasticsearch-master --replicas=0 -n default
kubectl scale statefulset elasticsearch-data --replicas=0 -n default
kubectl scale statefulset elasticsearch-ingest --replicas=0 -n default
kubectl scale statefulset elasticsearch-coordinating --replicas=0 -n default
```



